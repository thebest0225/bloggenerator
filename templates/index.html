<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ê³  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            background: white;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 350px;
            height: 100vh;
            background: linear-gradient(180deg, #F5DEB3 0%, #DEB887 100%);
            color: #5D4E37;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar.collapsed {
            transform: translateX(-300px);
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(93, 78, 55, 0.2);
        }

        .sidebar-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: #5D4E37;
        }

        .sidebar-section {
            padding: 15px;
            border-bottom: 1px solid rgba(93, 78, 55, 0.1);
        }

        .sidebar-section h6 {
            color: #8B4513;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .form-control, .form-select {
            background: rgba(255, 251, 240, 0.9);
            border: 1px solid rgba(222, 184, 135, 0.3);
            color: #5D4E37;
            font-size: 0.9rem;
        }

        .form-control::placeholder {
            color: rgba(93, 78, 55, 0.6);
        }

        .form-control:focus, .form-select:focus {
            background: rgba(255, 251, 240, 1);
            border-color: #DAA520;
            color: #5D4E37;
            box-shadow: 0 0 0 0.2rem rgba(218, 165, 32, 0.2);
        }

        .form-select option {
            color: #333;
            background: white;
        }

        .btn-sidebar {
            background: rgba(139, 69, 19, 0.2);
            color: #5D4E37;
            border: 1px solid rgba(139, 69, 19, 0.3);
            font-size: 0.85rem;
            padding: 8px 16px;
            width: 100%;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-sidebar:hover {
            background: rgba(139, 69, 19, 0.3);
            color: #3D2E1F;
            transform: translateY(-1px);
        }

        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 365px;
            z-index: 1001;
            background: #DAA520;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            padding: 10px 8px;
            transition: all 0.3s ease;
        }

        .sidebar-toggle.collapsed {
            left: 15px;
            border-radius: 5px;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            margin-left: 350px;
            padding: 20px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .main-content.expanded {
            margin-left: 50px;
        }

        .main-card { 
            background: linear-gradient(135deg, #FFF7E3 0%, #F5E6D3 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.2); 
            box-shadow: 0 8px 32px rgba(139, 69, 19, 0.1);
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .card { 
            background: linear-gradient(135deg, #FFFBF0 0%, #FFF7E3 100%);
            border: 1px solid rgba(222, 184, 135, 0.2); 
            box-shadow: 0 4px 20px rgba(139, 69, 19, 0.1);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .btn-primary { 
            background: linear-gradient(135deg, #DAA520, #B8860B);
            border: 1px solid rgba(218, 165, 32, 0.3);
            color: white;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #B8860B, #8B7500);
            border-color: #B8860B;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(218, 165, 32, 0.4);
        }

        .btn-primary:focus, .btn-primary:active {
            background: linear-gradient(135deg, #B8860B, #8B7500);
            border-color: #B8860B;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(218, 165, 32, 0.3);
        }

        /* ì¹´í…Œê³ ë¦¬ ìŠ¤íƒ€ì¼ - í…ìŠ¤íŠ¸ í˜•íƒœ */
        .category-item {
            background: rgba(139, 69, 19, 0.1);
            border-left: 3px solid rgba(218, 165, 32, 0.5);
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0 8px 8px 0;
        }

        .category-item:hover {
            background: rgba(139, 69, 19, 0.2);
            border-left-color: #DAA520;
            transform: translateX(3px);
        }

        .category-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #5D4E37;
        }

        .category-desc {
            font-size: 0.75rem;
            color: #8B4513;
            opacity: 0.8;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .keyword-list {
            font-size: 0.8rem;
            color: #A0522D;
            opacity: 0.9;
            line-height: 1.4;
        }

        .keyword-item {
            display: inline;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .keyword-item:hover {
            background: rgba(139, 69, 19, 0.2);
            color: #DAA520;
        }

        .keyword-separator {
            margin: 0 6px;
            opacity: 0.5;
            color: #8B4513;
        }

        /* ì¶”ì²œ í‚¤ì›Œë“œ - í…ìŠ¤íŠ¸ í˜•íƒœ */
        .trending-section {
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(93, 78, 55, 0.1);
        }

        .trending-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #5D4E37;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trending-keywords-list {
            font-size: 0.8rem;
            line-height: 1.5;
        }

        .trending-keyword-item {
            display: inline;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
            color: #8B4513;
        }

        .trending-keyword-item:hover {
            background: rgba(139, 69, 19, 0.2);
            color: #DAA520;
        }

        .google-keyword {
            color: rgba(66, 133, 244, 0.9);
        }

        .google-keyword:hover {
            color: #4285f4;
            background: rgba(66, 133, 244, 0.1);
        }

        .naver-keyword {
            color: white;
        }

        .naver-keyword:hover {
            color: #03c75a;
            background: rgba(3, 199, 90, 0.1);
        }

        .keyword-rank {
            font-size: 0.7rem;
            opacity: 0.6;
            margin-right: 4px;
        }

        .keyword-separator {
            margin: 0 8px;
            opacity: 0.4;
        }

        /* ì‹¤ì‹œê°„ í‚¤ì›Œë“œ ìŠ¤íƒ€ì¼ */
        .realtime-item {
            display: block;
            padding: 6px 0;
            margin: 3px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            color: #8B4513;
            border-bottom: 1px solid rgba(93, 78, 55, 0.05);
        }

        .realtime-item:hover {
            color: #DAA520;
            transform: translateX(3px);
        }

        .realtime-item:last-child {
            border-bottom: none;
        }

        .trend-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        /* ì ‘ê¸° ê¸°ëŠ¥ */
        .collapse-btn:hover {
            background: rgba(255,255,255,0.3) !important;
            transform: scale(1.1);
        }

        .collapsible-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .collapsed .collapsible-content {
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            opacity: 0;
        }

        .collapsed .card-header {
            border-radius: 15px !important;
        }

        .collapsed .collapse-btn i {
            transform: rotate(180deg);
        }

        /* ë¸”ë¡œê·¸ ìƒì„± ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-content {
            background: linear-gradient(135deg, #FFFBF0 0%, #FFF7E3 100%);
            border-radius: 20px;
            border: 1px solid rgba(222, 184, 135, 0.3);
            box-shadow: 0 20px 60px rgba(139, 69, 19, 0.2);
            color: #5D4E37;
        }

        .prompt-type-card {
            background: rgba(245, 222, 179, 0.3);
            border: 2px solid rgba(222, 184, 135, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #5D4E37;
        }

        .prompt-type-card.selected {
            background: linear-gradient(135deg, #DAA520, #B8860B);
            color: white;
            border-color: #DAA520;
        }

        .prompt-type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.1);
            background: rgba(245, 222, 179, 0.5);
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .nav-pills .nav-link {
            border-radius: 10px !important;
            font-weight: 600;
            transition: all 0.3s ease;
            background: rgba(218, 165, 32, 0.1);
            color: #8B4513;
            border: 1px solid rgba(218, 165, 32, 0.2);
        }

        .nav-pills .nav-link:hover {
            background: rgba(218, 165, 32, 0.2);
            color: #5D4E37;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(218, 165, 32, 0.2);
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #DAA520, #B8860B);
            color: white;
            border-color: #DAA520;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(218, 165, 32, 0.3);
        }

        .tab-content-wrapper {
            position: relative;
            background: linear-gradient(135deg, #FFFBF0 0%, #FFF7E3 100%);
            border-radius: 0 0 15px 15px;
            min-height: 500px;
            max-height: 70vh;
            overflow: hidden;
            border: 1px solid rgba(222, 184, 135, 0.2);
        }

        .tab-content {
            padding: 20px;
            padding-bottom: 80px;
            height: calc(70vh - 80px);
            overflow-y: auto;
            color: #5D4E37;
        }

        .tab-pane {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ê³ ì • ì•¡ì…˜ ë°” ìŠ¤íƒ€ì¼ */
        .fixed-action-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 50%, rgba(255,255,255,0) 100%);
            padding: 20px;
            border-top: 1px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: linear-gradient(135deg, #DAA520, #B8860B);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.3);
        }

        .action-btn:hover {
            background: linear-gradient(135deg, #B8860B, #8B7500);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(218, 165, 32, 0.4);
            color: white;
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #8B4513, #A0522D);
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
        }

        .action-btn.secondary:hover {
            background: linear-gradient(135deg, #654321, #8B4513);
        }

        .action-btn.success {
            background: linear-gradient(135deg, #228B22, #32CD32);
            box-shadow: 0 4px 15px rgba(34, 139, 34, 0.3);
        }

        .action-btn.success:hover {
            background: linear-gradient(135deg, #1E7E1E, #228B22);
        }

        .action-btn.warning {
            background: linear-gradient(135deg, #FF8C00, #FFA500);
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }

        .action-btn.warning:hover {
            background: linear-gradient(135deg, #FF7F00, #FF8C00);
        }

        .action-btn.info {
            background: linear-gradient(135deg, #CD853F, #DEB887);
            box-shadow: 0 4px 15px rgba(205, 133, 63, 0.3);
        }

        .action-btn.info:hover {
            background: linear-gradient(135deg, #BC7A36, #CD853F);
        }

        /* ì»´íŒ©íŠ¸í•œ í°íŠ¸ í¬ê¸° ì¡°ì • */
        .main-content {
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .main-content h1, .main-content h2, .main-content h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .main-content h4, .main-content h5, .main-content h6 {
            font-size: 0.95rem;
            margin-bottom: 0.4rem;
        }

        .main-content p, .main-content div, .main-content span {
            font-size: 0.8rem;
            line-height: 1.3;
        }

        .card-body {
            padding: 0.8rem;
        }

        .list-group-item {
            padding: 0.5rem 0.8rem;
            font-size: 0.8rem;
        }

        .alert {
            padding: 0.6rem;
            font-size: 0.8rem;
        }

        .badge {
            font-size: 0.65rem;
            padding: 0.25em 0.5em;
        }

        /* ëª¨ë‹¬ í¼ ì»´íŒ©íŠ¸ ë””ìì¸ */
        .modal-dialog {
            max-width: 600px;
        }

        .modal-body {
            padding: 1rem;
        }

        .modal-body h6 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .modal-body .form-label {
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
        }

        .modal-body .form-control,
        .modal-body .form-select {
            font-size: 0.8rem;
            padding: 0.4rem 0.6rem;
        }

        .modal-body .alert {
            padding: 0.5rem;
            font-size: 0.8rem;
        }

        .prompt-type-card {
            padding: 0.8rem;
            margin: 0.3rem 0;
        }

        .prompt-type-card h6 {
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .prompt-type-card small {
            font-size: 0.7rem;
        }

        /* ê³ ì • ì•¡ì…˜ ë°” í¬ê¸° ì¡°ì • */
        .fixed-action-bar {
            padding: 15px;
            background: linear-gradient(to top, rgba(255,251,240,1) 0%, rgba(255,251,240,0.95) 50%, rgba(255,251,240,0) 100%);
        }

        .action-btn {
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* ë¦¬ìŠ¤íŠ¸ ê·¸ë£¹ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .list-group-item {
            background: rgba(255, 251, 240, 0.8);
            border: 1px solid rgba(222, 184, 135, 0.2);
            color: #5D4E37;
        }

        .list-group-item:hover {
            background: rgba(245, 222, 179, 0.5);
            border-color: rgba(218, 165, 32, 0.3);
        }

        .list-group-item.active {
            background: linear-gradient(135deg, #DAA520, #B8860B);
            border-color: #DAA520;
            color: white;
        }

        /* ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .badge.bg-primary {
            background: linear-gradient(135deg, #DAA520, #B8860B) !important;
        }

        .badge.bg-success {
            background: linear-gradient(135deg, #228B22, #32CD32) !important;
        }

        .badge.bg-info {
            background: linear-gradient(135deg, #CD853F, #DEB887) !important;
        }

        .badge.bg-warning {
            background: linear-gradient(135deg, #FF8C00, #FFA500) !important;
            color: white !important;
        }

        /* ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ í˜¸ë²„ íš¨ê³¼ */
        .image-container:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                font-size: 0.8rem;
            }

            .sidebar-toggle {
                left: 15px;
            }

            .nav-pills .nav-link {
                font-size: 0.75rem;
                padding: 6px 10px;
            }

            .tab-content {
                max-height: 60vh;
            }

            .action-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
                font-weight: 500;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì´ë¯¸ì§€ ì»¬ëŸ¼ ì¡°ì • */
            .image-results .col-md-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }

            .image-container {
                height: 200px !important;
            }
        }
    </style>
</head>
<body>
    <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar" id="sidebar">
        <!-- ì‚¬ì´ë“œë°” í—¤ë” -->
        <div class="sidebar-header">
            <div class="mb-2">
                <a href="/" style="text-decoration: none;">
                    <img src="/attached_assets/logo_big2.png" alt="ë§ê³  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸" style="max-height: 120px; height: auto; cursor: pointer;">
                </a>
            </div>
            <p class="mb-0" style="font-size: 0.8rem; opacity: 0.8;">by Mangoabba</p>
            <div class="mt-2">
                <a href="/logout" class="btn btn-sm btn-outline-light" style="font-size: 0.7rem; padding: 4px 8px;">
                    <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                </a>
            </div>
        </div>

        <!-- í‚¤ì›Œë“œ ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="sidebar-section">
            <h6><i class="fas fa-search"></i> í‚¤ì›Œë“œ ê²€ìƒ‰</h6>
            <div class="mb-3">
                <input type="text" id="keywordInput" class="form-control" placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="row mb-3">
                <div class="col-6">
                    <select id="searchCount" class="form-select">
                        <option value="10">10ê°œ</option>
                        <option value="15" selected>15ê°œ</option>
                        <option value="20">20ê°œ</option>
                    </select>
                </div>
                <div class="col-6">
                    <select id="sortType" class="form-select">
                        <option value="date">ìµœì‹ ìˆœ</option>
                        <option value="sim" selected>ê´€ë ¨ë„ìˆœ</option>
                    </select>
                </div>
            </div>
            <button id="searchBtn" class="btn btn-sidebar">
                <i class="fas fa-search"></i> ê²€ìƒ‰ ì‹œì‘
            </button>
        </div>

        <!-- ì¶”ì²œ í‚¤ì›Œë“œ ì„¹ì…˜ -->
        <div class="sidebar-section">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0"><i class="fas fa-lightbulb"></i> ì¶”ì²œ í‚¤ì›Œë“œ</h6>
                <button class="btn btn-sm btn-outline-light" onclick="refreshRecommendedKeywords()" title="ìƒˆë¡œê³ ì¹¨">
                    <i class="fas fa-sync-alt" id="refreshIcon"></i>
                </button>
            </div>
            <div id="recommendedKeywords">
                <!-- ì¶”ì²œ í‚¤ì›Œë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
            <div class="text-center mt-2">
                <small class="text-muted">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdateTime">-</span></small>
            </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ -->
        <div class="sidebar-section">
            <h6><i class="fas fa-folder"></i> ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ</h6>
            <div id="categoryList">
                <!-- ì¹´í…Œê³ ë¦¬ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="main-content" id="mainContent">
        <!-- í—¤ë” -->
        <div class="main-card text-center mb-4 p-4">
            <div class="mb-3">
                <a href="/" style="text-decoration: none;">
                    <img src="/attached_assets/logo.png" alt="ë§ê³  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸" style="max-height: 160px; height: auto; cursor: pointer;">
                </a>
            </div>
            <p class="text-muted">ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê²€ìƒ‰ â†’ AI ë¶„ì„ â†’ ìµœì í™”ëœ ë¸”ë¡œê·¸ ê¸€ ìƒì„±</p>
            <div class="mt-3">
                <span class="badge bg-primary me-2">ğŸš€ AI ë¶„ì„</span>
                <span class="badge bg-success me-2">ğŸ“ ìë™ ìƒì„±</span>
                <span class="badge bg-info me-2">ğŸ¯ í‚¤ì›Œë“œ ìµœì í™”</span>
                <span class="badge bg-warning">ğŸ–¼ï¸ ì´ë¯¸ì§€ ìƒì„±</span>
            </div>
        </div>

        <!-- ë©”ì¸ ê²°ê³¼ íƒ­ ì»¨í…Œì´ë„ˆ -->
        <div id="resultsContainer" class="main-card" style="display: none;">
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <ul class="nav nav-pills nav-fill mb-3" id="resultTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="search-tab" data-bs-toggle="pill" data-bs-target="#search-content" type="button" role="tab">
                        <i class="fas fa-chart-bar"></i> ê²€ìƒ‰ê²°ê³¼
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="titles-tab" data-bs-toggle="pill" data-bs-target="#titles-content" type="button" role="tab">
                        <i class="fas fa-lightbulb"></i> ìƒì„±ì œëª©
                    </button>
                </li>
                <li class="nav-item" rolepresentation">
                    <button class="nav-link" id="blog-tab" data-bs-toggle="pill" data-bs-target="#blog-content" type="button" role="tab">
                        <i class="fas fa-file-alt"></i> ë¸”ë¡œê·¸ê¸€
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="images-tab" data-bs-toggle="pill" data-bs-target="#images-content" type="button" role="tab">
                        <i class="fas fa-images"></i> ì´ë¯¸ì§€
                    </button>
                </li>
            </ul>

            <!-- íƒ­ ì»¨í…ì¸  ë˜í¼ -->
            <div class="tab-content-wrapper">
                <!-- íƒ­ ì»¨í…ì¸  -->
                <div class="tab-content" id="resultTabContent">
                    <!-- ê²€ìƒ‰ ê²°ê³¼ íƒ­ -->
                    <div class="tab-pane fade show active" id="search-content" role="tabpanel" aria-labelledby="search-tab">
                        <div id="searchResults"></div>
                        <div id="analysisResults" style="display: none;"></div>
                    </div>

                    <!-- ìƒì„±ëœ ì œëª© íƒ­ -->
                    <div class="tab-pane fade" id="titles-content" role="tabpanel" aria-labelledby="titles-tab">
                        <div id="titleResults"></div>
                    </div>

                    <!-- ë¸”ë¡œê·¸ ê¸€ íƒ­ -->
                    <div class="tab-pane fade" id="blog-content" role="tabpanel" aria-labelledby="blog-tab">
                        <div id="blogResults"></div>
                    </div>

                    <!-- ì´ë¯¸ì§€ íƒ­ -->
                    <div class="tab-pane fade" id="images-content" role="tabpanel" aria-labelledby="images-tab">
                        <div id="imageResults"></div>
                    </div>
                </div>

                <!-- ê³ ì • ì•¡ì…˜ ë°” -->
                <div class="fixed-action-bar">
                    <!-- ê²€ìƒ‰ ê²°ê³¼ íƒ­ìš© ì•¡ì…˜ ë²„íŠ¼ -->
                    <div id="search-actions" class="action-buttons" style="display: none;">
                        <button class="action-btn" onclick="analyzeResults()">
                            <i class="fas fa-brain"></i> AI ë¶„ì„ ì‹œì‘
                        </button>
                    </div>

                    <!-- ë¶„ì„ ê²°ê³¼ìš© ì•¡ì…˜ ë²„íŠ¼ -->
                    <div id="analysis-actions" class="action-buttons" style="display: none;">
                        <button class="action-btn warning" onclick="generateTitles()">
                            <i class="fas fa-lightbulb"></i> ìƒˆë¡œìš´ ì œëª© ìƒì„±
                        </button>
                    </div>

                    <!-- ì œëª© ìƒì„± íƒ­ìš© ì•¡ì…˜ ë²„íŠ¼ -->
                    <div id="titles-actions" class="action-buttons" style="display: none;">
                        <button class="action-btn" onclick="openBlogGenerationModal()">
                            <i class="fas fa-pen"></i> ì„ íƒí•œ ì œëª©ìœ¼ë¡œ ë¸”ë¡œê·¸ ê¸€ ìƒì„±
                        </button>
                    </div>

                    <!-- ë¸”ë¡œê·¸ ê¸€ íƒ­ìš© ì•¡ì…˜ ë²„íŠ¼ -->
                    <div id="blog-actions" class="action-buttons" style="display: none;">
                        <button class="action-btn secondary" onclick="copyCurrentBlog()">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <button class="action-btn success" onclick="downloadCurrentBlog()">
                            <i class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button class="action-btn info" onclick="generateImages_(4)">
                            <i class="fas fa-images"></i> ì´ë¯¸ì§€ ìƒì„±
                        </button>
                    </div>

                    <!-- ì´ë¯¸ì§€ íƒ­ìš© ì•¡ì…˜ ë²„íŠ¼ -->
                    <div id="images-actions" class="action-buttons" style="display: none;">
                        <button class="action-btn info" onclick="generateImages_(4)">
                            <i class="fas fa-plus"></i> ì¶”ê°€ ì´ë¯¸ì§€ ìƒì„±
                        </button>
                        <button class="action-btn success" onclick="downloadAllImagesAsZip()">
                            <i class="fas fa-download"></i> ëª¨ë“  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¡œë”© ë° ìƒíƒœ í‘œì‹œ -->
        <div id="loading" class="text-center" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">ì²˜ë¦¬ ì¤‘...</p>
        </div>

        <div id="alerts"></div>
    </div>

    <!-- ë¸”ë¡œê·¸ ìƒì„± ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal fade" id="blogGenerationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-pen"></i> ë¸”ë¡œê·¸ ê¸€ ìƒì„± ì„¤ì •</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- ì„ íƒëœ ì œëª© í‘œì‹œ -->
                    <div class="alert alert-info">
                        <strong>ì„ íƒëœ ì œëª©:</strong> <span id="selectedTitleDisplay"></span>
                    </div>

                    <!-- ê¸€ ìœ í˜• ì„ íƒ -->
                    <div class="mb-4">
                        <h6>ê¸€ ìœ í˜• ì„ íƒ</h6>
                        <select class="form-select" id="promptType">
                            <option selected>ê¸€ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>

                    <!-- ê¸€ììˆ˜ ì„¤ì • -->
                    <div class="mb-4">
                        <h6>ê¸€ììˆ˜ ì„¤ì •</h6>
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">ìµœì†Œ ê¸€ììˆ˜ (ë¬¸ë‹¨ë³„ 1500ì)</label>
                            <select id="minChars" class="form-select">
                                <option value="6000" selected>6000ì (4ë¬¸ë‹¨Ã—1500ì)</option>
                                <option value="7500">7500ì (5ë¬¸ë‹¨)</option>
                                <option value="9000">9000ì (6ë¬¸ë‹¨)</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">ìµœëŒ€ ê¸€ììˆ˜</label>
                            <select id="maxChars" class="form-select">
                                <option value="8000">8000ì</option>
                                <option value="10000" selected>10000ì</option>
                                <option value="12000">12000ì</option>
                            </select>
                        </div>
                    </div>

                    <!-- ì¶”ê°€ í”„ë¡¬í”„íŠ¸ -->
                    <div class="mb-4">
                        <h6>ì¶”ê°€ ìš”ì²­ì‚¬í•­ (ì„ íƒ)</h6>
                        <textarea id="additionalPrompt" class="form-control" rows="3" placeholder="íŠ¹ë³„í•œ ìš”ì²­ì‚¬í•­ì´ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: íŠ¹ì • ê´€ì , í†¤ì•¤ë§¤ë„ˆ ë“±)"></textarea>
                    </div>

                    <!-- ì¶”ê°€ ì„¤ì • -->
                    <div class="mb-4">
                        <h6>ì¶”ê°€ ì„¤ì •</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="useKeywords">
                            <label class="form-check-label" for="useKeywords">
                                í‚¤ì›Œë“œ ìë™ ì‚½ì… (<strong>ì¶”ì²œ:</strong> 2~3ê°œ)
                            </label>
                        </div>
                    </div>

                    <!-- ìƒì„± ì„¤ì • ì•Œë¦¼ -->
                    <div class="alert alert-warning">
                        <strong>ì£¼ì˜:</strong> ê¸€ììˆ˜ ì„¤ì •ì— ë”°ë¼ ìƒì„± ì‹œê°„ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> ë‹«ê¸°
                    </button>
                    <button type="button" class="btn btn-primary" onclick="generateBlog()">
                        <i class="fas fa-magic"></i> ë¸”ë¡œê·¸ ê¸€ ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡¬í”„íŠ¸ ìœ í˜• ì„ íƒ ì¹´ë“œ -->
    <template id="promptTypeCardTemplate">
        <div class="prompt-type-card" data-prompt-type="{prompt_type}">
            <h6>{title}</h6>
            <small>{description}</small>
        </div>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentBlogContent = '';
        let generatedImages = [];
        let selectedTitle = '';
        let currentSessionId = null;
        let currentKeyword = '';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¨¼ì € ë“±ë¡
            initializeEventListeners();

            // ìš”ì†Œ ì¡´ì¬ í™•ì¸ í›„ í•¨ìˆ˜ ì‹¤í–‰
            setTimeout(function() {
                try {
                    loadRecommendedKeywords();
                    loadCategoryKeywords();
                    loadPromptTypes();
                } catch (error) {
                    console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                }
            }, 100);

            // íƒ­ ë³€ê²½ ì‹œ ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function (e) {
                    const targetId = e.target.getAttribute('data-bs-target');
                    showActionButtons(targetId);
                });
            });
        });

        // ì¶”ì²œ í‚¤ì›Œë“œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        function refreshRecommendedKeywords() {
            const refreshIcon = document.getElementById('refreshIcon');
            refreshIcon.classList.add('fa-spin');

            fetch('/api/recommended-keywords')
                .then(response => response.json())
                .then(data => {
                    displayRecommendedKeywords(data);
                    updateLastUpdateTime();
                })
                .catch(error => {
                    console.error('ì¶”ì²œ í‚¤ì›Œë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                })
                .finally(() => {
                    refreshIcon.classList.remove('fa-spin');
                });
        }

        // ì¶”ì²œ í‚¤ì›Œë“œ ë¡œë“œ
        function loadRecommendedKeywords() {
            fetch('/api/recommended-keywords')
                .then(response => response.json())
                .then(data => {
                    displayRecommendedKeywords(data);
                    updateLastUpdateTime();
                })
                .catch(error => {
                    console.error('ì¶”ì²œ í‚¤ì›Œë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                    document.getElementById('recommendedKeywords').innerHTML = 
                        '<div class="text-center text-muted">í‚¤ì›Œë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
                });
        }

        // ì¶”ì²œ í‚¤ì›Œë“œ í‘œì‹œ
        function displayRecommendedKeywords(data) {
            const container = document.getElementById('recommendedKeywords');

            if (!data.google_trends && !data.naver_datalab) {
                container.innerHTML = '<div class="text-center text-muted">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                return;
            }

            let html = '';

            // êµ¬ê¸€ íŠ¸ë Œë“œ í‚¤ì›Œë“œ
            if (data.google_trends && data.google_trends.length > 0) {
                html += `
                    <div class="trending-section">
                        <div class="trending-title">
                            <i class="fab fa-google"></i> êµ¬ê¸€ íŠ¸ë Œë“œ
                        </div>
                        <div class="trending-keywords-list">
                `;

                data.google_trends.forEach((item, index) => {
                    html += `
                        <span class="trending-keyword-item google-keyword" onclick="selectKeyword('${item.keyword}')">
                            <span class="keyword-rank">${index + 1}.</span>
                            ${item.keyword}
                        </span>
                    `;
                    if (index < data.google_trends.length - 1) {
                        html += '<span class="keyword-separator">â€¢</span>';
                    }
                });

                html += `
                        </div>
                    </div>
                `;
            }

            // ë„¤ì´ë²„ ë°ì´í„°ë© í‚¤ì›Œë“œ
            if (data.naver_datalab && data.naver_datalab.length > 0) {
                html += `
                    <div class="trending-section">
                        <div class="trending-title">
                            <i class="fas fa-chart-line"></i> ë„¤ì´ë²„ ë°ì´í„°ë©
                        </div>
                        <div class="trending-keywords-list">
                `;

                data.naver_datalab.forEach((item, index) => {
                    html += `
                        <span class="trending-keyword-item naver-keyword" onclick="selectKeyword('${item.keyword}')">
                            <span class="keyword-rank">${index + 1}.</span>
                            ${item.keyword}
                        </span>
                    `;
                    if (index < data.naver_datalab.length - 1) {
                        html += '<span class="keyword-separator">â€¢</span>';
                    }
                });

                html += `
                        </div>
                    </div>
                `;
            }

            if (html === '') {
                html = '<div class="text-center text-muted">ì¶”ì²œ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            }

            container.innerHTML = html;
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ ë¡œë“œ
        function loadCategoryKeywords() {
            fetch('/api/category-keywords')
                .then(response => response.json())
                .then(data => {
                    displayCategoryKeywords(data);
                })
                .catch(error => {
                    console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                    document.getElementById('categoryList').innerHTML = 
                        '<div class="text-center text-muted">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
                });
        }

        // ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ í‘œì‹œ
        function displayCategoryKeywords(categories) {
            const container = document.getElementById('categoryList');
            let html = '';

            categories.forEach(category => {
                html += `
                    <div class="category-item" onclick="toggleCategory(this)">
                        <div class="category-name">
                            ${category.icon} ${category.name}
                        </div>
                        <div class="category-desc">
                            ${category.description}
                        </div>
                        <div class="keyword-list">
                `;

                category.keywords.forEach((keyword, index) => {
                    html += `
                        <span class="keyword-item" onclick="event.stopPropagation(); selectKeyword('${keyword}')">
                            ${keyword}
                        </span>
                    `;
                    if (index < category.keywords.length - 1) {
                        html += '<span class="keyword-separator">â€¢</span>';
                    }
                });

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // í‚¤ì›Œë“œ ì„ íƒ
        function selectKeyword(keyword) {
            document.getElementById('keywordInput').value = keyword;
            showAlert(`"${keyword}" í‚¤ì›Œë“œê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdateTime').textContent = timeString;
        }

        // ê²€ìƒ‰ ì‹œì‘
        function startSearch() {
            console.log('ê²€ìƒ‰ ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const keywordInput = document.getElementById('keywordInput');
            const searchCountSelect = document.getElementById('searchCount');
            const sortTypeSelect = document.getElementById('sortType');
            
            if (!keywordInput) {
                console.error('í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                showAlert('í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'danger');
                return;
            }
            
            const keyword = keywordInput.value.trim();
            console.log('ì…ë ¥ëœ í‚¤ì›Œë“œ:', keyword);

            if (!keyword) {
                showAlert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            currentKeyword = keyword;
            showLoading(true);
            document.getElementById('resultsContainer').style.display = 'block';

            const count = searchCountSelect ? searchCountSelect.value : '15';
            const sort = sortTypeSelect ? sortTypeSelect.value : 'sim';

            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    keyword: keyword,
                    search_count: parseInt(count),
                    sort_type: sort
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentSessionId = data.session_id;
                    displaySearchResults(data);
                    showActionButtons('#search-content');
                } else {
                    showAlert(data.error || 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                }
            })
            .catch(error => {
                if (error.status === 401) {
                    showAlert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'warning');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                } else {
                    showAlert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                }
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            })
            .finally(() => {
                showLoading(false);
            });
        }

        // ì¶”ì²œ í‚¤ì›Œë“œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ ì¶”ê°€
        function refreshRecommendedKeywords() {
            const refreshIcon = document.getElementById('refreshIcon');
            if (refreshIcon) {
                refreshIcon.classList.add('fa-spin');
            }

            fetch('/api/recommended-keywords')
                .then(response => response.json())
                .then(data => {
                    displayRecommendedKeywords(data);
                    updateLastUpdateTime();
                })
                .catch(error => {
                    console.error('ì¶”ì²œ í‚¤ì›Œë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                })
                .finally(() => {
                    if (refreshIcon) {
                        refreshIcon.classList.remove('fa-spin');
                    }
                });
        }

        // ì¹´í…Œê³ ë¦¬ í† ê¸€
        function toggleCategory(element) {
            const keywordList = element.querySelector('.keyword-list');
            if (keywordList.style.display === 'none') {
                keywordList.style.display = 'block';
                element.style.background = 'rgba(255,255,255,0.1)';
            } else {
                keywordList.style.display = 'none';
                element.style.background = 'rgba(255,255,255,0.05)';
            }
        }

        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.getElementById('sidebarToggle');

            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            toggleBtn.classList.toggle('collapsed');
        }

        // ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
        function showActionButtons(targetId) {
            // ëª¨ë“  ì•¡ì…˜ ë²„íŠ¼ ìˆ¨ê¹€
            document.querySelectorAll('.action-buttons').forEach(btn => {
                btn.style.display = 'none';
            });

            // í•´ë‹¹ íƒ­ì˜ ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ
            let actionId = '';
            switch(targetId) {
                case '#search-content':
                    actionId = document.getElementById('analysisResults').style.display === 'none' ? 
                              'search-actions' : 'analysis-actions';
                    break;
                case '#titles-content':
                    actionId = 'titles-actions';
                    break;
                case '#blog-content':
                    actionId = 'blog-actions';
                    break;
                case '#images-content':
                    actionId = 'images-actions';
                    break;
            }

            if (actionId) {
                const actionElement = document.getElementById(actionId);
                if (actionElement) {
                    actionElement.style.display = 'flex';
                }
            }
        }

        // ë¡œë”© ìƒíƒœ í‘œì‹œ/ìˆ¨ê¹€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ í•¨ìˆ˜
        function initializeEventListeners() {
            console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ì‹œì‘');
            
            // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) {
                console.log('ê²€ìƒ‰ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
                searchBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    startSearch();
                });
            } else {
                console.error('ê²€ìƒ‰ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            // í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œì—ì„œ ì—”í„°í‚¤ ì²˜ë¦¬
            const keywordInput = document.getElementById('keywordInput');
            if (keywordInput) {
                console.log('í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
                keywordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        startSearch();
                    }
                });
            } else {
                console.error('í‚¤ì›Œë“œ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function showAlert(message, type = 'danger', duration = 5000) {
            const alertsDiv = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            alertsDiv.appendChild(alert);

            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, duration);
        }

        function displaySearchResults(data) {
            document.getElementById('searchResults').innerHTML = `
                <h5><i class="fas fa-search"></i> "${currentKeyword}" ê²€ìƒ‰ ê²°ê³¼ (${data.collected_titles}ê°œ ì œëª© ìˆ˜ì§‘)</h5>
                <div class="alert alert-info">
                    <strong>ìˆ˜ì§‘ ì™„ë£Œ:</strong> ì´ ${data.total_results}ê±´ì˜ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ${data.collected_titles}ê°œì˜ ì œëª©ì„ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤.
                </div>
                <div class="row">
                    ${data.titles.slice(0, 12).map((title, index) => `
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title">${title}</h6>
                                    <span class="badge bg-primary">${index + 1}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // AI ë¶„ì„ ì‹œì‘
        function analyzeResults() {
            if (!currentSessionId) {
                showAlert('ë¨¼ì € ê²€ìƒ‰ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            showLoading(true);

            fetch('/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    session_id: currentSessionId,
                    analysis_type: 'comprehensive'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayAnalysisResults(data);
                    showActionButtons('#search-content');
                } else {
                    showAlert(data.error || 'AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                }
            })
            .catch(error => {
                showAlert('AI ë¶„ì„ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
            })
            .finally(() => {
                showLoading(false);
            });
        }

        function displayAnalysisResults(data) {
            document.getElementById('analysisResults').style.display = 'block';
            document.getElementById('analysisResults').innerHTML = `
                <div class="mt-4">
                    <h5><i class="fas fa-brain"></i> AI ë¶„ì„ ê²°ê³¼</h5>
                    <div class="card">
                        <div class="card-body">
                            <div style="white-space: pre-wrap; line-height: 1.6;">${data.analysis_result}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ì œëª© ìƒì„±
        function generateTitles() {
            if (!currentSessionId) {
                showAlert('ë¨¼ì € ê²€ìƒ‰ê³¼ ë¶„ì„ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            showLoading(true);

            fetch('/api/generate_titles', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    session_id: currentSessionId,
                    num_titles: 10
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayTitleResults(data.titles);
                    // displayTitleResults í•¨ìˆ˜ ë‚´ì—ì„œ íƒ­ ì´ë™ ì²˜ë¦¬ë¨
                } else {
                    showAlert(data.error || 'ì œëª© ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                }
            })
            .catch(error => {
                showAlert('ì œëª© ìƒì„± ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                console.error('ì œëª© ìƒì„± ì˜¤ë¥˜:', error);
            })
            .finally(() => {
                showLoading(false);
            });
        }

        function displayTitleResults(titles) {
            document.getElementById('titleResults').innerHTML = `
                <h5><i class="fas fa-lightbulb"></i> ìƒì„±ëœ ë¸”ë¡œê·¸ ì œëª©ë“¤</h5>
                <p class="text-muted">ì œëª©ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                <div class="list-group">
                    ${titles.map((title, index) => `
                        <div class="list-group-item list-group-item-action" onclick="selectTitle('${title}')">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${index + 1}. ${title}</h6>
                                <span class="badge bg-primary">ì„ íƒ</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // ì œëª© ìƒì„± í›„ ìë™ìœ¼ë¡œ ìƒì„±ì œëª© íƒ­ìœ¼ë¡œ ì´ë™
            const titlesTab = document.querySelector('#titles-tab');
            if (titlesTab) {
                titlesTab.click();
            }
        }

        function selectTitle(title) {
            selectedTitle = title;
            showAlert(`"${title}" ì œëª©ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');

            // ì„ íƒëœ ì œëª© í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }

        // í”„ë¡¬í”„íŠ¸ íƒ€ì… ë¡œë“œ
        function loadPromptTypes() {
            const promptTypeSelect = document.getElementById('promptType');
            if (!promptTypeSelect) return;

            // ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ íƒ€ì…ë“¤
            const promptTypes = {
                'informative': 'ì •ë³´ ì œê³µí˜•',
                'experience': 'ê²½í—˜ ê³µìœ í˜•', 
                'comparison': 'ë¹„êµ ë¶„ì„í˜•',
                'howto': 'ì‹¤ìš© ê°€ì´ë“œí˜•',
                'storytelling': 'ìŠ¤í† ë¦¬í…”ë§í˜•'
            };

            promptTypeSelect.innerHTML = '';
            Object.entries(promptTypes).forEach(([key, name]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = name;
                promptTypeSelect.appendChild(option);
            });
        }

        function openBlogGenerationModal() {
            if (!selectedTitle) {
                showAlert('ë¨¼ì € ì œëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // ì„ íƒëœ ì œëª©ì„ ëª¨ë‹¬ì— í‘œì‹œ
            document.getElementById('selectedTitleDisplay').textContent = selectedTitle;

            const modal = new bootstrap.Modal(document.getElementById('blogGenerationModal'));
            modal.show();
        }

        function copyCurrentBlog() {
            if (!currentBlogContent) {
                showAlert('ë³µì‚¬í•  ë¸”ë¡œê·¸ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            navigator.clipboard.writeText(currentBlogContent)
                .then(() => {
                    showAlert('ë¸”ë¡œê·¸ ê¸€ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                })
                .catch(() => {
                    showAlert('ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                });
        }

        function downloadCurrentBlog() {
            if (!currentBlogContent || !selectedTitle) {
                showAlert('ë‹¤ìš´ë¡œë“œí•  ë¸”ë¡œê·¸ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            const blob = new Blob([currentBlogContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${selectedTitle}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showAlert('ë¸”ë¡œê·¸ ê¸€ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        function generateImages_(count) {
            if (!currentBlogContent) {
                showAlert('ë¨¼ì € ë¸”ë¡œê·¸ ê¸€ì„ ìƒì„±í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            showLoading(true);

            fetch('/generate-images', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title: selectedTitle,
                    content: currentBlogContent,
                    count: count
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    generatedImages = data.images;
                    displayImageResults(data.images);
                    // ì´ë¯¸ì§€ íƒ­ìœ¼ë¡œ ì´ë™
                    document.querySelector('#images-tab').click();
                } else {
                    showAlert(data.error || 'ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                }
            })
            .catch(error => {
                showAlert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
            })
            .finally(() => {
                showLoading(false);
            });
        }

        function displayImageResults(images) {
            document.getElementById('imageResults').innerHTML = `
                <h5><i class="fas fa-images"></i> ìƒì„±ëœ ì´ë¯¸ì§€ë“¤ (${images.length}ê°œ)</h5>
                <div class="row image-results">
                    ${images.map((image, index) => `
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="image-container" style="height: 300px; overflow: hidden;">
                                    <img src="${image.url}" alt="ìƒì„±ëœ ì´ë¯¸ì§€ ${index + 1}" 
                                         class="card-img-top w-100 h-100" style="object-fit: cover;">
                                </div>
                                <div class="card-body">
                                    <p class="card-text small">${image.prompt}</p>
                                    <button class="btn btn-sm btn-primary" onclick="downloadImage('${image.url}', 'ì´ë¯¸ì§€_${index + 1}')">
                                        <i class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename + '.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadAllImagesAsZip() {
            if (!currentSessionId) {
                showAlert('ì„¸ì…˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²€ìƒ‰ì„ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            showLoading(true);

            // ZIP ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•œ ìƒˆ ì°½ìœ¼ë¡œ ì—´ê¸°
            const downloadUrl = `/api/download_images/${currentSessionId}`;
            console.log(`ğŸ” ë‹¤ìš´ë¡œë“œ URL: ${downloadUrl}`);
            console.log(`ğŸ“‹ í˜„ì¬ ì„¸ì…˜ ID: ${currentSessionId}`);

            fetch(downloadUrl, {
                method: 'GET'
            })
            .then(response => {
                console.log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status}`);
                if (response.ok) {
                    return response.blob();
                } else {
                    return response.json().then(errorData => {
                        throw new Error(errorData.error || 'ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
                    });
                }
            })
            .then(blob => {
                // Blobì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'generated_images.zip';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showAlert('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            })
            .catch(error => {
                console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                showAlert(`ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'danger');
            })
            .finally(() => {
                showLoading(false);
            });
        }

        function generateBlog() {
            if (!selectedTitle) {
                showAlert('ì œëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const modal = bootstrap.Modal.getInstance(document.getElementById('blogGenerationModal'));
            modal.hide();

            showLoading(true);

            const promptType = document.getElementById('promptType').value;
            const minChars = document.getElementById('minChars').value;
            const maxChars = document.getElementById('maxChars').value;
            const additionalPrompt = document.getElementById('additionalPrompt').value;

            fetch('/api/generate_blog', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    session_id: currentSessionId,
                    title: selectedTitle,
                    prompt_type: promptType,
                    additional_prompt: additionalPrompt,
                    min_chars: parseInt(minChars),
                    max_chars: parseInt(maxChars)
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentBlogContent = data.content;
                    displayBlogResults(data);
                    document.querySelector('#blog-tab').click();
                } else {
                    showAlert(data.error || 'ë¸”ë¡œê·¸ ê¸€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                }
            })
            .catch(error => {
                showAlert('ë¸”ë¡œê·¸ ê¸€ ìƒì„± ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                console.error('ë¸”ë¡œê·¸ ìƒì„± ì˜¤ë¥˜:', error);
            })
            .finally(() => {
                showLoading(false);
            });
        }

function displayBlogResults(data) {
            const blogResults = document.getElementById('blogResults');
            if (blogResults) {
                blogResults.innerHTML = `
                    <div class="blog-result-header mb-3">
                        <h5><i class="fas fa-file-alt"></i> ${data.title}</h5>
                        <div class="alert alert-info d-flex justify-content-between align-items-center">
                            <span>ì´ ê¸€ììˆ˜: <strong>${data.char_count}</strong>ì</span>
                            <small>SEO ìµœì í™” ì™„ë£Œ âœ…</small>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div id="blogContent" style="white-space: pre-wrap; line-height: 1.8; font-size: 16px;">${data.content}</div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary me-2" onclick="copyBlogContent()">
                                <i class="fas fa-copy"></i> ë³µì‚¬
                            </button>
                            <button class="btn btn-success me-2" onclick="downloadBlogContent()">
                                <i class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="btn btn-info" onclick="previewSEO()">
                                <i class="fas fa-search"></i> SEO ë¯¸ë¦¬ë³´ê¸°
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function copyBlogContent() {
            if (currentBlogContent) {
                navigator.clipboard.writeText(currentBlogContent).then(() => {
                    showAlert('ë¸”ë¡œê·¸ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }).catch(err => {
                    showAlert('ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                });
            }
        }

        function downloadBlogContent() {
            if (currentBlogContent) {
                const blob = new Blob([currentBlogContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${selectedTitle || 'ë¸”ë¡œê·¸_ê¸€'}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showAlert('ë¸”ë¡œê·¸ ê¸€ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        function previewSEO() {
            if (currentBlogContent) {
                const keywordCount = (currentBlogContent.match(new RegExp(currentKeyword, 'gi')) || []).length;
                const charCount = currentBlogContent.length;
                const wordCount = currentBlogContent.split(/\s+/).length;

                showAlert(`SEO ë¶„ì„ ê²°ê³¼:\n- í‚¤ì›Œë“œ '${currentKeyword}' ${keywordCount}íšŒ í¬í•¨\n- ì´ ${charCount}ì, ${wordCount}ë‹¨ì–´\n- SEO ìµœì í™”: ${keywordCount >= 5 ? 'ìš°ìˆ˜' : 'ë³´í†µ'}`, 'info');
            }
        }

        function refreshRecommendedKeywords() {
            console.log('í‚¤ì›Œë“œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
            loadRecommendedKeywords();
            showAlert('ì¶”ì²œ í‚¤ì›Œë“œë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // í”„ë¡¬í”„íŠ¸ íƒ€ì… ë¡œë“œ
        function loadPromptTypes() {
            const promptTypeSelect = document.getElementById('promptType');
            if (!promptTypeSelect) return;

            const promptTypes = {
                'default': 'ê¸°ë³¸ ìŠ¤íƒ€ì¼',
                'informative': 'ì •ë³´ ì œê³µ ìŠ¤íƒ€ì¼',
                'persuasive': 'ì„¤ë“ ìŠ¤íƒ€ì¼',
                'humorous': 'ìœ ë¨¸ ìŠ¤íƒ€ì¼',
                'technical': 'ê¸°ìˆ  ìŠ¤íƒ€ì¼'
            };

            promptTypeSelect.innerHTML = '';
            for (const key in promptTypes) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = promptTypes[key];
                promptTypeSelect.appendChild(option);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');

            // ì•ˆì „í•˜ê²Œ í•¨ìˆ˜ í˜¸ì¶œ
            try {
                loadRecommendedKeywords();
                loadCategoryKeywords();
                loadPromptTypes();
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
            }

            // í•„ìˆ˜ ìš”ì†Œë“¤ ì¡´ì¬ í™•ì¸
            const requiredElements = ['promptType', 'minChars', 'maxChars'];
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    console.warn(`${id} ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.`);
                }
            });
        });

        // í‚¤ì›Œë“œ ì„ íƒ í•¨ìˆ˜
        function selectKeyword(keyword) {
            const keywordInput = document.getElementById('keywordInput');
            if (keywordInput) {
                keywordInput.value = keyword;
                showAlert(`í‚¤ì›Œë“œ "${keyword}"ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }

        // ì¶”ì²œ í‚¤ì›Œë“œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        function refreshRecommendedKeywords() {
            const refreshIcon = document.getElementById('refreshIcon');
            if (refreshIcon) {
                refreshIcon.classList.add('fa-spin');
            }

            loadRecommendedKeywords()
                .finally(() => {
                    if (refreshIcon) {
                        refreshIcon.classList.remove('fa-spin');
                    }
                });
        }
</script>
</body>
</html>